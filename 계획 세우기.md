# 정리


### `initializr.generator` 작업

1. Properties 인터페이스 추가 (이름 적절하게 변경)
   - 이거 Properties의 Properties 확장자로 계속 이름이 중복되서 좀 고민 중...
   - 패키지 이름이랑 디 properties.properties라고 할 순 없잖아.
   - 근데 이미 Properties라고 쓰고 있으니까 흠...
2. properties, yaml 구현체 추가 및 팩토리 적용, spring.factories에 추가 필요
   - 이것도 테스트 필요하려나? 확인해보기
3. `ProjectDescription`, `MutableProjectDescription` 에 properties 추가
   - 프로젝트 설계도 작성하는 역할임. core에서 씀.
4. `ConditionalOnProperties`, `OnPropertiesCondition` 작업하기
   - 이건 테스트 아직 못함


### `initializr.metadata` 작업

1. `InitializrMetadata`, `InitializrMetadataBuilder`에 properties 정보 추가
2. `InitializrMetadataTestBuilder`에 정보 추가하고 관련 테스트코드 실행
- `InitializrMetadata`는 `start.spring.io` 같은 곳에서 어떤 것들 지원하는지 설명하는 쪽

### `initializr.generator.spring` 작업

1. ApplicationProperties에 yaml 기능 추가하고 테스트코드 작성
2. `ApplicationYamlPropertiesContributor` 구현 (이름 바꿔야할수도)
3. `ApplicationPropertiesProjectGenerationConfiguration` 에 분기별 처리 추가
4. `ProjectGeneratorIntegrationTests`랑 `ApplicationPropertiesTests` 테스트 추가
   - 그 외에 필요한 테스트들도 다 추가

### `initializr.web` 작업

1. `DefaultProjectRequestToDescriptionConverter`, `ProjectRequest` 추가
2. 그 외 및 관련 테스트 수정

# 엄...

생각보다 뭐 할게 적은데? 이러면 1000줄 안넘을듯?   
테스트까지 하면 넘을수도?  

그 외에 필요한게 더 있나 싶은데, 내가 코드 분석한 결과로는 충분한거 같음.

일단 이렇게 해서 PR 올리고, 피드백 받고... 하면 될 듯?

# gemini 피셜

(근데 좀 보완할 것도 많고, 당연한 이야기만해서 별로인듯?) 

✦ 물론입니다. yang-sijun님의 Git 커밋 기록을 바탕으로, application.properties 또는
application.yml 파일을 선택하는 기능을 처음부터 다시 구현하는 과정을 단계별로 설명해
드리겠습니다.

최종 목표: 사용자가 `application.properties`와 `application.yml` 중 원하는 설정 파일
형식을 선택하여 프로젝트를 생성할 수 있도록 하기

이 목표를 달성하기 위한 개발 과정은 다음과 같이 체계적으로 나눌 수 있습니다.

  ---

1단계: 핵심 개념 정의 및 API 설계

가장 먼저, 새로운 기능을 위한 기본 뼈대를 만듭니다. 이 단계는 기능의 확장성과
유지보수성을 결정하는 중요한 과정입니다.

1. `PropertiesType` 인터페이스 정의:
    * 파일: initializr-generator/src/main/java/io/spring/initializr/generator/properti
      es/PropertiesType.java
    * 목적: .properties, .yml 등 다양한 설정 파일 형식을 표현할 수 있는 공통
      인터페이스를 만듭니다. 이를 통해 나중에 다른 형식(예: .toml)을 추가하기
      쉬워집니다.
    * 핵심 코드:

1         public interface PropertiesType {
2             String id(); // "properties", "yaml"과 같은 고유 ID 반환
3         }

2. `PropertiesType` 구현체 생성:
    * 파일:
        * initializr-generator/src/main/java/io/spring/initializr/generator/properties
          /properties/PropertiesPropertiesType.java
        * initializr-generator/src/main/java/io/spring/initializr/generator/properties
          /yaml/YamlPropertiesType.java
    * 목적: 각 파일 형식에 맞는 구체적인 클래스를 만듭니다.
    * 핵심 코드: PropertiesType 인터페이스를 구현하고, id() 메서드가 각각
      "properties", "yaml"을 반환하도록 합니다.

3. `ProjectDescription`에 `propertiesType` 필드 추가:
    * 파일: initializr-generator/src/main/java/io/spring/initializr/generator/project/P
      rojectDescription.java
    * 목적: 프로젝트 생성에 필요한 모든 정보를 담는 ProjectDescription 객체에 사용자가
      선택한 설정 파일 형식 정보를 저장할 수 있도록 합니다.
    * 핵심 코드:
        * 인터페이스에 PropertiesType getPropertiesType(); 메서드를 추가합니다.
        * 구현체인 MutableProjectDescription에 private PropertiesType propertiesType;
          필드와 getter/setter를 추가합니다. 기존 프로젝트와의 호환성을 위해 기본값으로
          new PropertiesPropertiesType()을 설정합니다.

  ---

2단계: 웹 요청과 생성 로직 연결

사용자의 선택을 실제 파일 생성 로직에 전달하는 과정입니다.

1. `ProjectRequest`에 `propertiesType` 필드 추가:
    * 파일: initializr-web/src/main/java/io/spring/initializr/web/project/ProjectReque
      st.java

    * 목적: 웹 요청(GET 또는 POST)으로 들어온 propertiesType 파라미터 값을 저장합니다.
    * 핵심 코드: private String propertiesType; 필드와 getter/setter를 추가합니다.

2. `DefaultProjectRequestToDescriptionConverter` 수정:
    * 파일: initializr-web/src/main/java/io/spring/initializr/web/project/DefaultProje
      ctRequestToDescriptionConverter.java
    * 목적: 웹 요청(ProjectRequest)을 내부 프로젝트 정보(ProjectDescription)로
      변환하는 역할을 하는 이 클래스에서 propertiesType을 전달하도록 수정합니다.
    * 핵심 코드: convert 메서드 내에서 request.getPropertiesType()으로 값을 가져와
      description.setPropertiesType()을 통해 설정합니다.

3. `SpringFactoriesLoader`를 이용한 `PropertiesType` 팩토리 등록:
    * 파일: initializr-generator/src/main/resources/META-INF/spring.factories
    * 목적: PropertiesType의 구현체를 동적으로 찾을 수 있도록 Spring의 서비스 로더에
      등록합니다. 이는 코드 간의 결합도를 낮추는 중요한 역할을 합니다.
    * 핵심 코드: io.spring.initializr.generator.properties.PropertiesTypeFactory 키에
      PropertiesPropertiesTypeFactory와 YamlPropertiesTypeFactory를 추가합니다.

  ---

3단계: 조건부 파일 생성 로직 구현

사용자의 선택에 따라 .properties 파일을 생성할지, .yml 파일을 생성할지 결정하는
로직을 구현합니다.

1. `@ConditionalOnProperties` 어노테이션 생성:
    * 파일:
        * initializr-generator/src/main/java/io/spring/initializr/generator/condition/C
          onditionalOnProperties.java (어노테이션 정의)
        * initializr-generator/src/main/java/io/spring/initializr/generator/condition/O
          nPropertiesCondition.java (조건 로직)
    * 목적: ProjectDescription의 propertiesType 값에 따라 특정 빈(Bean)을 활성화하거나
      비활성화할 수 있는 커스텀 조건부 어노테이션을 만듭니다.
    * 핵심 코드: OnPropertiesCondition 클래스에서 ProjectDescription의 propertiesType을
      확인하여 조건에 부합하는지 판단하는 로직을 구현합니다.

2. `ApplicationYamlPropertiesContributor` 클래스 생성:
    * 파일: initializr-generator/src/main/java/io/spring/initializr/generator/spring/p
      roperties/ApplicationYamlPropertiesContributor.java
    * 목적: application.yml 파일을 생성하고 내용을 쓰는 역할을 담당하는 클래스입니다.
    * 핵심 코드: ProjectContributor 인터페이스를 구현하고, contribute 메서드에서
      src/main/resources/application.yaml 파일을 생성합니다.

3. `ApplicationPropertiesProjectGenerationConfiguration` 수정:
    * 파일: initializr-generator/src/main/java/io/spring/initializr/generator/spring/p
      roperties/ApplicationPropertiesProjectGenerationConfiguration.java
    * 목적: 조건부 어노테이션을 사용하여 propertiesType 값에 따라
      ApplicationPropertiesContributor 또는 ApplicationYamlPropertiesContributor 빈을
      생성하도록 설정합니다.
    * 핵심 코드:
        * 기존 applicationPropertiesContributor() 메서드에
          @ConditionalOnProperties("properties")를 추가합니다.
        * applicationYamlPropertiesContributor() 메서드를 새로 만들고
          @ConditionalOnProperties("yaml")을 추가합니다.

4. `ApplicationProperties`에 YAML 변환 로직 추가:
    * 파일: initializr-generator/src/main/java/io/spring/initializr/generator/spring/p
      roperties/ApplicationProperties.java
    * 목적: server.port=8080과 같은 플랫한 키-값 데이터를 계층적인 YAML 형식으로
      변환하는 writeToYaml 메서드를 구현합니다.
    * 핵심 코드:
        1. 점(.)으로 구분된 키를 분리하여 Map<String, Object> 형태의 중첩된 구조로
           변환합니다.
        2. 재귀(recursion)를 통해 중첩된 맵을 순회하며 들여쓰기(indentation)가 적용된
           YAML 형식의 문자열을 생성합니다.

  ---

4단계: 테스트 및 검증

새로운 기능이 올바르게 동작하는지, 그리고 기존 기능에 영향을 주지 않는지 확인합니다.

1. 단위 테스트(Unit Test) 추가:
    * 파일: initializr-generator/src/test/java/io/spring/initializr/generator/spring/p
      roperties/ApplicationPropertiesTests.java
    * 목적: writeToYaml 메서드가 정확한 YAML 문자열을 생성하는지 독립적으로
      테스트합니다.

2. 통합 테스트(Integration Test) 추가:
    * 파일: initializr-generator/src/test/java/io/spring/initializr/generator/spring/P
      rojectGeneratorIntegrationTests.java
    * 목적: 실제 프로젝트 생성 시나리오를 테스트합니다.
    * 핵심 코드:
        1. propertiesType을 yaml로 설정한 ProjectDescription 객체를 생성합니다.
        2. 프로젝트 생성기를 실행합니다.
        3. 결과물에 application.yaml 파일이 존재하는지, 그리고 application.properties
           파일은 없는지 확인합니다.

이러한 체계적인 단계를 통해, yang-sijun님은 기존 코드를 최대한 활용하면서 새로운
기능을 유연하고 안정적으로 추가했습니다. 각 단계는 기능 구현, 테스트, 리팩토링을
포함하며, 이는 소프트웨어 개발의 좋은 예시입니다.
