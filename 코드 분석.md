# 0. 소개

프로젝트 개요 설명은 https://docs.spring.io/initializr/docs/current/reference/html 참고


# 1. 전체적인 흐름

- 여러가지 앞 단에서 호출 가능: 컨트롤러, CLI 뭐 이거저거 있는거 같은데, 어차피 내부 로직은 똑같으니까 스킵
- `ProjectGenerationInvoker`: 프로젝트 생성 API 요청을 처리함.
    - web 모듈에 있음. 핵심 로직이라기보단, 실제 동작을 보기 위한 예시 정도로 참고하기. 나머지는 `initializr-generator`, `initializr-generator-spring` 참고
    - `ProjectRequest`를 받아서 `ProjectDescription`을 반환
    - `ProjectGenerationContext`를 커스터마이즈 해서 `ProjectGenerator`를 생성
    - `ProjectGenerator`를 호출하여 프로젝트를 생성한다.
- `InitializrMetadata`: 뭐지 이거? 커스터마이징 기능 같은데, core에서 제공하긴 하는데, 주요 로직은 아닌 듯?
- `ProjectGenerationCondition`: `ProjectGenerationContext`에 특정 `Contributor`를 빈으로 등록하도록 하는 `Conditional`의 부모
    - TODO: 스프링에서 `Conditional` 클래스와 어노테이션이 어떻게 동작하는지도 나중에 자세하게 찾아봐야 할 듯.
        - 당장은 어노테이션 스캔할 때 matches를 실행해서 맞으면 빈으로 등록하는걸로 예상되고, 실제로도 맞을거 같은데, 좀 확인 필요
    - 구현체들은 `io.spring.initializr.generator.condition`에서 확인할 수 있다.
    - `ProjectGenerationContext`가 만들어지고 refresh 될 때, 알아서 스캔하고 조건에 맞으면 등록된다.
- `ProjectDescription`: 프로젝트 생성에 필요한 모든 정보가 정의됨.
- `ProjectGenerationContext`: 전용 애플리케이션 컨텍스트
    - 프로젝트 생성에 필요한 컨텍스트를 가지고 있다.
    - 요청 시마다 새로 생기고, 전역으로 관리되지 않는다. 메서드 파라미터 전달을 사용해서 동시성 문제를 피한다.
    - 공통 인프라는 보통 메인 `ApplicationContext`에 설정해두고, 그걸 부모로 해서 `ProjectGenerationContext`를 요청마다 생성한다.
    - `ProjectGenerationContext`에는 `ProjectDescription`과 `ProjectContributor`를 가지고 있다.
        - 그 외에도 `MetadataBuildItemResolver`나 다른 걸 추가할 수 있다고 함. `Context`니까 제한은 없을 듯?
- `@ProjectGenerationConfiguration`: 프로젝트 생성 설정의 진입점
    - 메인 `ApplicationContext`의 `@ComponentScan`의 범위에 포함되지 않게 주의하며 사용해야 한다.
        - 대신 `ProjectGenerator`가 `SpringFactoriesLoader`를 통해 명시적으로 등록한다.
        - 그래서 실행 환경에 맞는 `ProjectGenerationCondition`만 등록되게 설정하는 것.
- `ProjectGenerator`: 프로젝트 생성의 핵심 로직
    - `generate` 함수 보면 됨
        - `ProjectGenerationContext`에 `registerProjectDescription`, `registerProjectContributors` 해서 처리에 필요한 객체를 다 등록
- `ProjectAssetGenerator`: 람다 인터페이스, 프로젝트 assets을 생성하는 역할
    - `DefaultProjectAssetGenerator`: 여러 코드 실행해서 파일에 쓰고, 등록된 `ProjectContributor` 다 실행함.


# 2. 기타 메모

이정도면 일단 전체 흐름 보기에는 좋을 듯?

`initializr-generator` 모듈은 진짜 그냥 JVM 관련 쪽이라 추상화되서 핵심 동작에선 보이지도 않네.

yaml을 추가하려면 프로퍼티 쓰는 Contributor를 바꾸면 될 듯?

----------

# Spring Initializr 코드 분석

## 0. 개요

Spring Initializr는 요청된 조건에 맞는 Spring Boot 프로젝트의 기본 구조를 생성해주는 도구입니다. 이 문서는 프로젝트 생성 요청이 처리되는 내부 동작 흐름과 주요 컴포넌트의 역할을 분석합니다.
공식 문서는 [Spring Initializr Reference](https://docs.spring.io/initializr/docs/current/reference/html)에서 확인할 수 있습니다.

## 1. 프로젝트 생성 전체 흐름

프로젝트 생성은 다음과 같은 단계로 이루어집니다.

1.  **요청 접수**: 사용자의 요청(`ProjectRequest`)이 웹 컨트롤러, CLI 등 다양한 채널을 통해 접수됩니다.
2.  **요청 분석 및 변환**: `ProjectGenerationInvoker`가 `ProjectRequest`를 기반으로 프로젝트의 명세서인 `ProjectDescription`을 생성합니다. 이때 `InitializrMetadata`를 참조하여 요청의 유효성을 검증하고 기본값을 채웁니다.
3.  **생성 컨텍스트 준비**: `ProjectGenerator`가 `ProjectGenerationContext`를 생성할 준비를 합니다. 이 컨텍스트는 프로젝트 생성을 위한 일회용 Spring `ApplicationContext`입니다.
4.  **Bean 등록**: `SpringFactoriesLoader`가 클래스패스에서 `@ProjectGenerationConfiguration` 설정 클래스들을 찾아 컨텍스트에 등록합니다.
5.  **조건부 Bean 활성화**: 컨텍스트가 초기화되면서, `ProjectDescription`의 내용(e.g., 선택된 의존성, 언어)에 따라 `@Conditional`이 붙은 Bean(`ProjectContributor`, `BuildCustomizer` 등)들만 활성화됩니다.
6.  **프로젝트 생성**: `ProjectGenerator`가 컨텍스트 내에 등록된 `ProjectContributor`들을 실행하여 `pom.xml`, 소스 코드, 설정 파일 등 프로젝트 자산을 생성합니다.
7.  **결과 반환**: 생성된 프로젝트 파일들이 압축 파일 등의 형태로 사용자에게 반환됩니다.

## 2. 주요 컴포넌트 설명

### `ProjectGenerationInvoker`
- **역할**: 프로젝트 생성 흐름 전체를 관장하는 **오케스트레이터(Orchestrator)**.
- **위치**: `initializr-web` 모듈에 위치하며, 실제 생성 로직의 진입점 역할을 합니다.
- **동작**:
    1.  외부로부터 `ProjectRequest`(웹 요청 DTO)를 받습니다.
    2.  `InitializrMetadata`를 사용해 `ProjectRequest`를 검증하고, 이를 기반으로 내부 모델인 `ProjectDescription`을 생성합니다.
    3.  `ProjectGenerator`를 호출하여 실제 생성 프로세스를 시작합니다.

### `InitializrMetadata`
- **역할**: 생성 가능한 프로젝트의 **옵션 카탈로그**.
- **설명**: 사용 가능한 Spring Boot 버전, 의존성, 언어, 패키징 타입 등의 정보를 담고 있습니다. UI를 채우거나 사용자의 요청을 검증하는 데 사용되는 핵심 데이터입니다. 보통 `application.yml` 파일에 정의된 내용을 파싱하여 구성됩니다.

### `ProjectDescription`
- **역할**: 생성할 프로젝트의 모든 정보를 담는 **설계 명세서(Blueprint)**.
- **설명**: 사용자가 요청한 내용(e.g., Group, Artifact, 의존성, Java 버전 등)이 정규화된 형태로 저장됩니다. 이 객체는 프로젝트 생성 과정 전반에 걸쳐 "어떤 프로젝트를 만들어야 하는가?"에 대한 정보를 제공하며, 조건부 Bean 활성화의 기준이 됩니다.

### `ProjectGenerationContext`
- **역할**: 프로젝트 생성을 위한 **일회용 실행 환경(Runtime Environment)**.
- **설명**:
    - 경량화된 Spring `ApplicationContext`이며, 프로젝트 요청이 있을 때마다 새로 생성되고 폐기됩니다.
    - `ProjectDescription`을 Bean으로 가지고 있어, 다른 Bean들이 생성 명세에 접근할 수 있습니다.
    - `SpringFactoriesLoader`를 통해 로드된 `@ProjectGenerationConfiguration` 설정들을 기반으로 구성됩니다.

### `@ProjectGenerationConfiguration`
- **역할**: 프로젝트 생성에 필요한 Bean들을 정의하는 **설정 클래스 표식**.
- **설명**:
    - 이 애노테이션이 붙은 클래스는 `ProjectGenerationContext`에 포함될 `@Configuration` 클래스임을 나타냅니다.
    - 일반적인 `@ComponentScan`이 아닌 `META-INF/spring.factories` 파일에 등록된 클래스들을 `SpringFactoriesLoader`가 읽어와 로드합니다. 이를 통해 Initializr의 주 `ApplicationContext`와 프로젝트 생성 컨텍스트가 분리됩니다.

### `ProjectGenerationCondition`
- **역할**: 특정 조건에 따라 Bean을 활성화하는 **규칙**.
- **설명**: Spring의 `@Conditional`을 상속받는 애노테이션들의 기반입니다. `ProjectDescription`의 상태(e.g., `@ConditionalOnRequestedDependency`는 특정 의존성이 요청되었는지 검사)를 확인하여, 조건에 맞는 `ProjectContributor`나 `BuildCustomizer` 같은 Bean들만 `ProjectGenerationContext`에 등록되도록 합니다.

### `ProjectGenerator`
- **역할**: 프로젝트 생성을 실행하는 **핵심 엔진(Engine)**.
- **동작**:
    1.  `ProjectDescription`을 받아 `ProjectGenerationContext`를 생성합니다.
    2.  컨텍스트를 초기화하여 조건에 맞는 Bean들을 활성화합니다.
    3.  컨텍스트에서 모든 `ProjectContributor` Bean을 찾아 실행시킵니다.

### `ProjectContributor`
- **역할**: 실제 파일과 디렉터리를 생성하는 **작업자(Worker)**.
- **설명**: 이 인터페이스의 구현체들은 `pom.xml` 생성, `Application.java` 작성, `.gitignore` 파일 추가 등 개별적인 파일 생성 작업을 수행합니다. `ProjectGenerator`에 의해 호출되어 프로젝트의 자산을 만듭니다.
